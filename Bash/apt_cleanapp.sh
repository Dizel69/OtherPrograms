#!/usr/bin/env bash

# apt_cleanup_manager.sh ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã –ø–∞–∫–µ—Ç–æ–≤ APT —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

LOG_FILE="/var/log/apt_cleanup.log"
DATE_FMT="+%Y-%m-%d %H:%M:%S"

# –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Ç–∞–π–º—Å—Ç–∞–º–ø–æ–º
log() {
    echo -e "$(date "${DATE_FMT}")  $1" | tee -a "${LOG_FILE}"
}

# –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
remove_unused() {
    log "üßπ –ó–∞–ø—É—Å–∫ apt autoremove"
    if sudo apt autoremove -y >> "${LOG_FILE}" 2>&1; then
        log "‚úîÔ∏è  –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–¥–∞–ª–µ–Ω—ã"
    else
        log "‚ùó –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
    fi
}

# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø–∞–∫–µ—Ç–æ–≤
clean_cache() {
    log "üóÑÔ∏è  –ó–∞–ø—É—Å–∫ apt clean"
    if sudo apt clean >> "${LOG_FILE}" 2>&1; then
        log "‚úîÔ∏è  –ö—ç—à –ø–∞–∫–µ—Ç–æ–≤ –æ—á–∏—â–µ–Ω"
    else
        log "‚ùó –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –∫—ç—à–∞"
    fi
}

# –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –ø–∞–∫–µ—Ç–æ–≤ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫—ç—à–∞
autoclean_cache() {
    log "üóëÔ∏è  –ó–∞–ø—É—Å–∫ apt autoclean"
    if sudo apt autoclean >> "${LOG_FILE}" 2>&1; then
        log "‚úîÔ∏è  –õ–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à –æ–±–Ω–æ–≤–ª—ë–Ω"
    else
        log "‚ùó –û—à–∏–±–∫–∞ –ø—Ä–∏ autoclean"
    fi
}

main() {
    log "üõ†Ô∏è  –°—Ç–∞—Ä—Ç –æ—á–∏—Å—Ç–∫–∏ APT"
    remove_unused
    clean_cache
    autoclean_cache
    log "‚úÖ –û—á–∏—Å—Ç–∫–∞ APT –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
}

main
